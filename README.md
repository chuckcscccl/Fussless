## Fussless: Rustlr Target for F\#

"Fussless" is a parser generation system for F\# written in Rust as part of the
**[Rustlr](https://crates.io/crates/rustlr)** parser generator. This package contains the .Net end of the project including the runtime parser and
routines to interpret the parsing tables generated by Rustlr.
Rustlr was originally designed to generate parsers for Rust and
its main capabilities are now available for F\# targets including the
`auto` option to automatically generate the abstract syntax types and semantic actions.
The system also recognizes the operators +, \*, ?, as well as the <\_*> and
<\_+> opertions and creates vectors (ResizeArray) for them.  
However, some of the experimental features such as the "-lrsd" option
and the `_` wildcard are not currently available.

The lexical analysis aspect of the system is written in C#, although
other tokenizers can be used by conforming to the AbstractLexer
interface.  Fussless can automatically generate a lexical analyzer in
the form of a .lex file from the grammar. The .lex file can be
compiled by *CsLex*, which is available at
[https://github.com/zbrad/CsLex](https://github.com/zbrad/CsLex)

The contents of this repository are as follows:

- **RuntimeParser.fs** : This is the main implementation of the F# side of
  Rustlr/Fussless.  Currently, there are limitations to the runtime parser
  as there is no error-recovery capability.  

- **absLexer.cs** : contains basic interface and utility classes to be used by
  the automatically generated lexical scanners. RuntimeParser and absLexer define the *Fussless* namespace.

- test1.grammar, calce.grammar, test1main.fs, calcemain.fs: these are
  sample grammars and "main" files that test the parsers and tokenizers
  generated for them.

- fs7c.grammar : larger grammar for a simplified programming language that
  demonstrates the most advanced features of the system.

- sample : dotnet9 project directory with sample .fsproj file

- multisample : dotnet9 project directory with sample .fsproj file and
  sub-directory lexer containing a C\# project component.
  
- Makefile : written for a Mono command-line environment


### Building Fussless

First, install Rust (if you don't have it) from rust-lang.org, then
install rustlr with **cargo install rustlr**.  Rustlr is found at
[crates.io/crates/rustlr](https://crates.io/crates/rustlr), which also
contains links to a tutorial and its reference documentation.  

The .Net end of the system can be built as a `dotnet` project with the
[Fussless.fsproj](https://github.com/chuckcscccl/Fussless/blob/main/Fussless.fsproj) file included in the repository.  After cloning the
repository you can create a new project but make sure that the .fsproj
file contains the same contents as `Fussless.fsproj`.

It's also possible to build Fussless using Mono and the `mcs` and `fsharpc`
compilers:

  1. compile absLexer.cs:  **mcs absLexer.cs /t:library**
  2. compile RuntimeParser.fs:  **fsharpc RuntimeParser.fs -a -r absLexer.dll**

This will create **absLexer.dll** and **RuntimeParser.dll** that are
required by all parsers.  Unless you create your parsing applications
within the Fussless directory you should **`export MONO_PATH =
where/ever/you/put/Fussless/`** for mono to find these assemblies.

<p>

The repository contains the CsLex executable (lex.exe).  However,
if this does not work, download and build CsLex (generate the lex.exe
program).  *Note: to build CsLex on newer Windows systems, you must
manually create the directory `lex/bin` (or `lex\bin`) before running
nmake in `lex/src/.*` The `lex.exe` file will be created in the bin
directory by nmake.



### Constructing and testing a parser.

Each parser contains a component in F\# as well as one in C\# (the
lexical tokenizer).  This can be built as F\# `dotnet` project that
contains a C\# project in a subdirectory as demonstrated by the skeleton
`multisample` directory included in the repository.  The sample
contains a grammar (`calcautofs.grammar`) and a `main` that expects
all the component of the generated parser.  Follow these steps:

  1. Run the rustlr application on the grammar:
     ```
       rustlr calcautofs.grammar -fsharp
     ```
     This produces the files `calcautofs_ast.fs`, `calcautofsparser.fs` and
     `calcautofs.lex`.
     Run the included CSlex executable (lex.exe) on the `.lex` file,
     which creates `calcautofs_lex.cs`: move this file to the lexer
     subdirectory.

  2. The lexer sub-directory should also contain `absLexer.cs`, which
     is found in the Fussless repository (or a reference to
     `absLexer.dll`).  Build this directory into a C\# `classlib` project.

  3. Back in the `multisample` folder/project, be sure to `dotnet add reference`
     to the both the Fussless project and to the lexer sub-project. Follow
     the contents of the sample [multisample.fsproj](https://github.com/chuckcscccl/Fussless/blob/main/multisample/multisample.fsproj) file.

  4. `dotnet run`


#### Using Fussless with Mono

The Fussless project was originally created with Mono and comes with a
Mono-compatible
Makefile](https://github.com/chuckcscccl/Fussless/blob/main/Makefile)
.  This is another way to use Fussless. If you move the makefile
outside of the Fussless directory then you should change the FUSSLESS
variable in the makefile accordingly.

To build a parser from a grammar such as test1.grammar, run

>      make GRAMMAR=test1

The GRAMMAR must be specified in the command.  This will run rustlr on the
grammar and build test1parser.dll and test1_lex.dll.  If there are additional
sources or libraries that are required to create the parser (e.g., the AST
definition) run make with a definition for 'ADDITIONAL', for example:

>      make GRAMMAR=test2 ADDITIONAL=/r:test2_ast.dll

Optionally, if you've written a main program for your grammar, one
that invokes the parser, then you can invoke make with

>      make GRAMMAR=test1 MAIN=test1main

This assumes that there's a file 'test1main.fs' and will build test1main.exe.

##### **AUTOAST** option

To build a parser from a grammar that automatically generates abstract syntax
types and semantic actions, run

>      make GRAMMAR=fs7c AUTOAST=true

where `fs7c.grammar` defines a simplified programming language.  The generated
AST types will be in `fs7c_ast.fs`

<br>

Although the makefile will call rustlr on the grammar, we recommend
rustlr be called separately so that it's clear if there's anything
wrong with the grammar.

<p>

A **[tutorial](https://chuckcscccl.github.io/rustlr_project/chapterfs.html)** on
how to write grammars for Fussless is available.
